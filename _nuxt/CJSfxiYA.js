import{u as G,_ as V}from"./P0RXK5Yl.js";import{_ as J}from"./BGlc_sEu.js";import{q as O,o as y,c as S,a as p,t as _,n as X,e as f,b as H,w as B,d as A,p as q,g as v,E as K,A as P,z as U,F as L,C as j}from"./Cr04wkDS.js";import{a as Q,_ as Z}from"./BWPvVLAZ.js";import"./SrowpwBi.js";import"./UJssAqB_.js";const ee={class:"w-16 h-16 sm:w-20 sm:h-20 rounded-full overflow-hidden bg-gray-100 dark:bg-gray-800 flex-shrink-0 mr-4 flex items-center justify-center"},te=["src","alt"],oe={key:1,class:"text-2xl font-bold text-gray-400"},ne={class:"flex-1"},ae={class:"text-xl font-bold"},re={key:0,class:"text-3xl"},se=O({__name:"ResultItem",props:{character:{},index:{}},setup(e){const a=e,{currentSrc:i,imageError:t,handleImageError:o}=G(()=>a.character.image),c=l=>l===0?"text-yellow-500":l===1?"text-gray-400":l===2?"text-orange-600":"text-gray-600 dark:text-gray-300",g=v(()=>{switch(a.character.series){case"WindBreaker":return"blue";case"Haikyu":return"orange";case"MHA":return"red";default:return"gray"}}),n=v(()=>{switch(a.character.series){case"WindBreaker":return"é˜²é¢¨å°‘å¹´";case"Haikyu":return"æŽ’çƒå°‘å¹´";case"MHA":return"æˆ‘çš„è‹±é›„å­¸é™¢";default:return a.character.series}});return(l,b)=>{const h=V;return y(),S("div",{class:X(["flex items-center p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700 select-none",{"ring-2 ring-yellow-400 dark:ring-yellow-500":e.index===0}])},[p("div",{class:X(["text-3xl font-black w-16 text-center",c(e.index)])}," #"+_(e.index+1),3),p("div",ee,[f(t)?(y(),S("div",oe,_(e.character.name.charAt(0)),1)):(y(),S("img",{key:0,src:f(i),alt:e.character.name,class:"w-full h-full object-cover",onError:b[0]||(b[0]=(...w)=>f(o)&&f(o)(...w))},null,40,te))]),p("div",ne,[p("h3",ae,_(e.character.name),1),H(h,{color:f(g),variant:"solid",class:"mt-1"},{default:B(()=>[A(_(f(n)),1)]),_:1},8,["color"])]),e.index===0?(y(),S("div",re," ðŸ‘‘ ")):q("",!0)],2)}}});async function Y(e){const a=[".jpg",".jpeg",".webp",".png"],i=e.replace(/\.(jpg|jpeg|webp|png)$/i,""),t=o=>new Promise((c,g)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>c(n),n.onerror=g,n.src=o});try{return await t(e)}catch{for(const o of a)try{return await t(i+o)}catch{continue}throw new Error(`Failed to load image: ${e}`)}}function N(e,a,i,t,o){e.save(),e.beginPath(),e.arc(i,t,o,0,Math.PI*2),e.closePath(),e.clip();const c=Math.max(o*2/a.width,o*2/a.height),g=a.width*c,n=a.height*c,l=i-g/2,b=t-n/2;e.drawImage(a,l,b,g,n),e.restore()}function T(e,a,i,t,o){e.font=`${o.fontWeight} ${o.fontSize}px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif`,e.fillStyle=o.color,e.textAlign=o.align,e.textBaseline="middle";let c=a;if(o.maxWidth&&e.measureText(a).width>o.maxWidth){let n=a;for(;e.measureText(n+"...").width>o.maxWidth&&n.length>0;)n=n.slice(0,-1);c=n+"..."}e.fillText(c,i,t)}function ie(e){return e===1?"#FFD700":e===2?"#C0C0C0":e===3?"#CD7F32":"#6B7280"}function D(e,a,i,t,o=24,c="center"){const n={WindBreaker:{text:"é˜²é¢¨å°‘å¹´",bg:"#DBEAFE",color:"#1E40AF"},Haikyu:{text:"æŽ’çƒå°‘å¹´",bg:"#FED7AA",color:"#C2410C"},MHA:{text:"æˆ‘çš„è‹±é›„å­¸é™¢",bg:"#FECACA",color:"#B91C1C"}}[a];if(!n)return 0;e.font=`bold ${o}px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif`;const l=e.measureText(n.text).width,b=16,h=o+12,w=l+b*2;let C=i;return c==="left"&&(C=i+w/2),e.fillStyle=n.bg,e.beginPath(),e.roundRect(C-w/2,t-h/2,w,h,10),e.fill(),T(e,n.text,C,t,{fontSize:o,fontWeight:"bold",color:n.color,align:"center"}),w}async function ce(e,a=["WindBreaker","Haikyu","MHA"]){const i=document.createElement("canvas"),t=i.getContext("2d");if(!t)throw new Error("Failed to get canvas context");i.width=1600,i.height=1600,t.fillStyle="#FFFFFF",t.fillRect(0,0,1600,1600);const o=e.length>=10?"Top 10":`Top ${e.length}`;let c=60;const g=60,n=10;for(const d of a){const u=D(t,d,c,g,18,"left");c+=u+n}T(t,o,1520,60,{fontSize:30,fontWeight:"bold",color:"#9CA3AF",align:"right"});const l=e[0];if(l)try{const d=await Y(l.image);t.font='bold 54px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';const u=t.measureText("#1").width;t.font='bold 48px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';const r=Math.min(t.measureText(l.name).width,500),s=60,F=800-(u+s+250+s+500)/2,m=F+u/2,W=F+u+s+125,z=W+125+s,E=200;T(t,"#1",m,E,{fontSize:54,fontWeight:"bold",color:"#FFD700",align:"center"}),N(t,d,W,E,125),T(t,l.name,z,E-25,{fontSize:56,fontWeight:"bold",color:"#1F2937",align:"left",maxWidth:500}),D(t,l.series,z,E+30,24,"left")}catch(d){console.error("Failed to load first place image:",d)}const b=400,h=50,w=e.slice(1,10),C=1600-h*2-200,R=1600-b-h*2-100,M=C/3,I=R/3;for(let d=0;d<w.length;d++){const u=w[d],r=d+2,s=d%3,x=Math.floor(d/3),k=h+M/2+s*(M+h)+30,$=b+h+I/2+x*(I+h);try{const F=ie(r),m=`#${r}`;T(t,m,k,$-220,{fontSize:36,fontWeight:"bold",color:F,align:"center"});const W=await Y(u.image);N(t,W,k,$-100,100),T(t,u.name,k,$+50,{fontSize:32,fontWeight:"600",color:"#374151",align:"center",maxWidth:M-60}),D(t,u.series,k,$+95,24,"center")}catch(F){console.error(`Failed to load image for ${u.name}:`,F)}}return new Promise((d,u)=>{i.toBlob(r=>{r?d(r):u(new Error("Failed to generate blob"))},"image/png",1)})}const le={class:"text-center mb-6"},de={class:"text-4xl font-bold mb-2"},ge={class:"flex items-center justify-center gap-2 mb-2 text-sm text-gray-500 dark:text-gray-400"},ue={class:"text-xs text-gray-400 dark:text-gray-500 mb-4"},me={class:"flex justify-center gap-4"},fe={class:"max-w-2xl mx-auto space-y-4"},he={key:0,class:"max-w-2xl mx-auto mt-12 space-y-2"},xe={class:"w-12 text-center font-mono text-gray-400 dark:text-gray-500"},pe={class:"flex-1 text-gray-400 dark:text-gray-500"},Se=O({__name:"results",setup(e){const{sortedList:a,selectedSeries:i,comparisonCount:t,startTime:o,endTime:c}=Q(),g=v(()=>Math.min(10,a.value.length)),n=v(()=>a.value.slice(0,g.value)),l=v(()=>a.value.slice(g.value)),b=v(()=>`ä½ çš„ Top ${g.value} æŽ’å`),h=v(()=>t.value),w=v(()=>!o.value||!c.value?0:Math.floor((c.value-o.value)/1e3)),C=v(()=>{const r=w.value;if(r<60)return`00:${r.toString().padStart(2,"0")}`;if(r<3600){const s=Math.floor(r/60),x=r%60;return`${s.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`}else{const s=Math.floor(r/3600),x=Math.floor(r%3600/60),k=r%60;return`${s.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}`}}),R=()=>{P({name:"index"})},M=async()=>{try{const r=await ce(n.value,i.value),s=URL.createObjectURL(r),x=document.createElement("a");x.download=`æˆ‘çš„Top${g.value}è§’è‰²æŽ’å_${new Date().getTime()}.png`,x.href=s,x.click(),URL.revokeObjectURL(s)}catch(r){console.error("ç”Ÿæˆåœ–ç‰‡å¤±æ•—:",r)}};K(()=>{a.value.length===0&&P({name:"index"})});const I={WindBreaker:"é˜²é¢¨å°‘å¹´",Haikyu:"æŽ’çƒå°‘å¹´",MHA:"æˆ‘çš„è‹±é›„å­¸é™¢"},d=r=>I[r]||r,u=r=>{switch(r){case"WindBreaker":return"blue";case"Haikyu":return"orange";case"MHA":return"red";default:return"gray"}};return(r,s)=>{const x=V,k=J,$=se,F=Z;return y(),U(F,{class:"min-h-screen py-10"},{default:B(()=>[p("div",le,[p("h1",de,_(f(b)),1),p("div",ge,[s[0]||(s[0]=p("span",null,"æœ¬æ¬¡åŒ…å«ä½œå“ï¼š",-1)),(y(!0),S(L,null,j(f(i),m=>(y(),U(x,{key:m,color:u(m),variant:"subtle",size:"xs"},{default:B(()=>[A(_(d(m)),1)]),_:2},1032,["color"]))),128))]),p("p",ue," æ¸¬é©—ç”¨æ™‚ "+_(f(C))+" ï½œ ç¸½å°æ±ºæ¬¡æ•¸ "+_(f(h))+" æ¬¡ ",1),p("div",me,[H(k,{icon:"i-heroicons-arrow-path",color:"gray",onClick:R},{default:B(()=>[...s[1]||(s[1]=[A(" é‡æ–°é–‹å§‹ ",-1)])]),_:1}),H(k,{icon:"i-heroicons-arrow-down-tray",onClick:M},{default:B(()=>[...s[2]||(s[2]=[A(" ä¸‹è¼‰æˆªåœ– ",-1)])]),_:1})])]),p("div",fe,[(y(!0),S(L,null,j(f(n),(m,W)=>(y(),U($,{key:m.id,character:m,index:W},null,8,["character","index"]))),128))]),f(l).length>0?(y(),S("div",he,[(y(!0),S(L,null,j(f(l),(m,W)=>(y(),S("div",{key:m.id,class:"flex items-center gap-3 p-2 text-sm opacity-60 hover:opacity-100 transition-opacity"},[p("span",xe,"#"+_(W+f(g)+1),1),p("span",pe,_(m.name),1),H(x,{size:"xs",variant:"solid",color:u(m.series),class:"opacity-60"},{default:B(()=>[A(_(d(m.series)),1)]),_:2},1032,["color"])]))),128))])):q("",!0)]),_:1})}}});export{Se as default};
